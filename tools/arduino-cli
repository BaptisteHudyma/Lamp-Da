#!/bin/bash
VENV_DIR=${VENV_DIR:-$PWD/venv}
ARDUINO_LOC=${ARDUINO_LOC:-$PWD/_build/arduino-cli}

mkdir -p $ARDUINO_LOC
export ARDUINO_DIRECTORIES_USER=$ARDUINO_LOC/user
export ARDUINO_DIRECTORIES_DATA=$ARDUINO_LOC/data
export ARDUINO_DIRECTORIES_DOWNLOADS=$ARDUINO_LOC/downloads
mkdir -p $ARDUINO_DIRECTORIES_USER $ARDUINO_DIRECTORIES_DATA $ARDUINO_DIRECTORIES_DOWNLOADS
. $VENV_DIR/bin/activate
export PATH="$VENV_DIR/bin:$ARDUINO_LOC:$PATH"

if [ -z "$PARALLEL_JOBS" ];
then arduino-cli "$@"
else arduino-cli -j$PARALLEL_JOBS "$@"
fi
